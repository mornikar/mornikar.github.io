<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hi Mornikar,Are you still peeping at me through the screen? | Dr.GT_Mornikar</title><link rel="icon" type="image/x-icon" href="../../../favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="../../../font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="../../../font/BenderLight.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="../../../font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="../../../css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><meta name="page-config" content="{&quot;code_fold&quot;:null}"><script class="pjax-js">var config = {"root":"/","code_fold":15,"search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}};
var page_config = {
  code_fold: null
};
function updatePageConfig() {
  var newPageConfig = document.querySelector('meta[name="page-config"]');
  if (newPageConfig) {
    page_config = JSON.parse(newPageConfig.content);
  }
}
document.addEventListener('pjax:complete', function() { updatePageConfig(); });
updatePageConfig();</script><link type="text/css" rel="stylesheet" href="../../../lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="../../../lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('../../../img/bk.jpg');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="../../../js/arknights.js"></script><script defer src="../../../js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="../../../lib/encrypt/hbe.js"></script><script async src="../../../js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
const postBg = document.querySelector('#post-bg');
if (postBg) lightGallery(postBg, {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="Dr.GT_Mornikar" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="../../../"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="LearningNotes/**,tags"><a class="navBlock" href="../../../archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="../../../LearningNotes/"><span class="navItemTitle">LearningNotes</span></a></li><li class="navItem"><a class="navBlock" href="../../../LearningEssays/"><span class="navItemTitle">LearningEssays</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1></h1></div><hr><div id="post-content"><attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-6aee844c-a460-47c2-b5b9-ab405fe354d6"></attachment><p><br></p><pre class="ql-syntax" spellcheck="false">create table Student(SId varchar(10),Sname varchar(10),Sage datetime,Ssex 
varchar(10));
insert into Student values('01' , '赵雷' , '1990-01-01' , '男');
insert into Student values('02' , '钱电' , '1990-12-21' , '男');
insert into Student values('03' , '孙风' , '1990-12-20' , '男');
insert into Student values('04' , '李云' , '1990-12-06' , '男');
insert into Student values('05' , '周梅' , '1991-12-01' , '女');
insert into Student values('06' , '吴兰' , '1992-01-01' , '女');
insert into Student values('07' , '郑竹' , '1989-01-01' , '女');
insert into Student values('09' , '张三' , '2017-12-20' , '女');
insert into Student values('10' , '李四' , '2017-12-25' , '女');
insert into Student values('11' , '李四' , '2012-06-06' , '女');
insert into Student values('12' , '赵六' , '2013-06-13' , '女');
insert into Student values('13' , '孙七' , '2014-06-01' , '女');

create table Course(CId varchar(10),Cname nvarchar(10),TId varchar(10));
insert into Course values('01' , '语文' , '02');
insert into Course values('02' , '数学' , '01');
insert into Course values('03' , '英语' , '03');

create table Teacher(TId varchar(10),Tname varchar(10));
insert into Teacher values('01' , '张三');
insert into Teacher values('02' , '李四');
insert into Teacher values('03' , '王五');

create table SC(SId varchar(10),CId varchar(10),score decimal(18,1));
insert into SC values('01' , '01' , 80);
insert into SC values('01' , '02' , 90);
insert into SC values('01' , '03' , 99);
insert into SC values('02' , '01' , 70);
insert into SC values('02' , '02' , 60);
insert into SC values('02' , '03' , 80);
insert into SC values('03' , '01' , 80);
insert into SC values('03' , '02' , 80);
insert into SC values('03' , '03' , 80);
insert into SC values('04' , '01' , 50);
insert into SC values('04' , '02' , 30);
insert into SC values('04' , '03' , 20);
insert into SC values('05' , '01' , 76);
insert into SC values('05' , '02' , 87);
insert into SC values('06' , '01' , 31);
insert into SC values('06' , '03' , 34);
insert into SC values('07' , '02' , 89);
insert into SC values('07' , '03' , 98);
</pre><p>表结构如下：</p><p>-- 1.学生表</p><p>-- Student(SId,Sname,Sage,Ssex)</p><p>-- SId 学生编号,Sname 学生姓名,Sage 出生年月,Ssex 学生性别</p><p><br></p><p>-- 2.课程表</p><p>-- Course(CId,Cname,TId)</p><p>-- CId 课程编号,Cname 课程名称,TId 教师编号</p><p><br></p><p>-- 3.教师表</p><p>-- Teacher(TId,Tname)</p><p>-- TId 教师编号,Tname 教师姓名</p><p><br></p><p>-- 4.成绩表</p><p>-- SC(SId,CId,score)</p><p>-- SId 学生编号,CId 课程编号,score 分数</p><p><br></p><p><strong>题目、答案及解析：</strong></p><p><strong>-- 1 查询 01 课程比 02 课程分数高的学生信息和课程分数</strong></p><p>-- 第一步: 用sid来join 两个sc表：第一个表是学生01课程的成绩，第二个表是学生02课程的成绩</p><p>-- 第二步: 加入学生的信息即可</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.*, t.score1, t.score2 from student, (
select sc1.sid, sc1.cid, sc1.score as score1, sc2.score as score2 from 
(select sid, cid, score from sc where cid = '01') as sc1
inner join
(select sid, cid, score from sc where cid = '02') as sc2
on sc1.sid = sc2.sid where sc1.score &gt; sc2.score) as t where student.sid = t.sid;
</pre><p><br></p><p>-- 1.1 查询同时存在01课程和02课程的情况</p><p>-- join</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from ( select * from sc where  cid = '01') sc1
inner join ( select * from sc where  cid = '02') sc2 on sc1.sid = sc2.sid
</pre><p><br></p><p>-- 1.2 查询存在01课程但是可能不存在02课程的情况（不存在时显示null）</p><p>-- join</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from ( select * from sc where  cid = '01') sc1 
left join ( select * from sc where  cid = '02') sc2 on sc1.sid = sc2.sid
</pre><p><br></p><p>-- 1.3 查询不存在01课程但是存在02课程的情况（不存在时显示null）</p><p>-- join</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from ( select * from sc where  cid = '01') sc1 
right  join ( select * from sc where  cid = '02') sc2 on sc1.sid = sc2.sid
</pre><p><br></p><p>-- 2. 查询平均成绩大于等于 60 分的同学的学生编号和学生姓名和平均成绩</p><p>-- HAVING AVG(variable)</p><p>-- AVG 一般配套 HAVING 这个词使用</p><p>-- GROUP BY</p><p><br></p><pre class="ql-syntax" spellcheck="false">select s.sid,sname,sage,ssex sscore 
from student as s, 
(select sid, avg(score) as sscore 
 from sc 
 group by sid 
 having avg(score) &gt; 60) as r 
where s.sid = r.sid;
</pre><p><br></p><p>-- 3.查询在 SC 表存在成绩的学生信息</p><p>--- DISTINCT</p><p>-- method 1: where</p><p><br></p><pre class="ql-syntax" spellcheck="false">select distinct student.* from student, sc where student.sid = sc.sid
</pre><p><br></p><p>-- method 2 : left join, and condition</p><p><br></p><pre class="ql-syntax" spellcheck="false">select distinct student.* from student left join sc 
on sc.sid = student.sid where sc.score is not null;
</pre><p><br></p><p>-- 4.查询所有同学的学生编号、学生姓名、选课总数、所有课程的成绩总和</p><p>-- group by, sum, join, count</p><p>-- 首先通过sc表格查询每个有成绩的学生的分数总和和选课总数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sid, count(cid), sum(score) from sc group by sid;
</pre><p><br></p><p>-- 然后把这张表作为查询的一部分加入到where联合查询中</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.sid, student.sname, t.courseCount, t.allScore  
from student, (
select sid, count(cid) as courseCount, sum(score) as allScore 
from sc group by sid
) as t where student.sid = t.sid ;
</pre><p>-- 或者也可以使用 inner join</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.sid, student.sname, t.courseCount, t.allScore  
from student inner join (
select sid, count(cid) as courseCount, sum(score) as allScore 
from sc group by sid
) as t on student.sid = t.sid ;
</pre><p><br></p><p>-- 5.查询 李 姓老师的数量</p><p><br></p><pre class="ql-syntax" spellcheck="false">select count(*) from teacher where tname like '李%';
</pre><p><br></p><p><br></p><p>-- 6. 查询 张三 老师授课的同学信息</p><p>-- 首先查出来张三老师教了哪些课</p><p><br></p><pre class="ql-syntax" spellcheck="false">select course.cid, course.cname, teacher.tid, teacher.tname 
from course left join teacher on course.tid = teacher.tid where tname = '张三';
</pre><p>-- 然后把这个表和成绩表join一下,记得要把查询条件放到最外面</p><p><br></p><pre class="ql-syntax" spellcheck="false">select distinct sc.sid, sc.cid from sc left join  (
select course.cid,  teacher.tid, teacher.tname 
from course left join teacher on course.tid = teacher.tid ) tc 
on sc.cid = tc.cid where tc.tname = '张三';
</pre><p>-- 最后用where把插叙结果和学生表合起来即可</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.* from student, (
select distinct sc.sid, sc.cid from sc left join  (
select course.cid,  teacher.tid, teacher.tname 
from course left join teacher on course.tid = teacher.tid ) tc 
on sc.cid = tc.cid where tc.tname = '张三') r where student.sid = r.sid;
</pre><p>-- 当然也有一种更简单的方法</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.* from student.teacher,course.sc
where student.sid = sc.sid and course.cid = sc.cid 
and course.tid = teacher.tid and tname = '张三';
</pre><p>-- inner join也可以</p><p><br></p><pre class="ql-syntax" spellcheck="false">SELECT s.*
FROM student AS s INNER JOIN sc ON s.sid = sc.sid
INNER JOIN  course  AS c ON sc.cid = c.cid
INNER JOIN teacher AS t ON t.tid = c.tid
WHERE t.tname = '张三';
</pre><p><br></p><p>-- 7. 查询没有学全所有课程的同学的信息</p><p>-- not in</p><p>-- group by 前用where ，group by 后用having</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from student where student.sid not in (
select sid from sc group by sc.sid 
having count(cid) = (select count(*) from course)
);
</pre><p><br></p><p>-- 8.查询至少有一门课与学号为01的同学所学的课程相同的同学信息</p><p>-- 1. 在sc中查询所有学生01选的课</p><p>-- 2. 列出sc中所有学生的选课代号出现在结果1中的sid</p><p>-- 3. 根据2的结果查询学生信息</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.* from student, (
select distinct sid from sc where cid in 
(
select cid from sc where sid = '01'
) ) as result where student.sid = result.sid;
</pre><p><br></p><p>-- 9.查询和"01"号的同学学习的课程完全相同的其他同学的信息</p><p>-- 考察知识点：group by 后跟的是having 而不是where</p><p>-- 第一步：将01同学所学习的所有课程找出;</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid from sc where sid = '01'
</pre><p><br></p><p>-- 第二步：将01同学没学过的所有课程找出；</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid from course where cid not in (select cid from sc where sid = '01')
</pre><p><br></p><p>-- 第三步：将学过01同学没学过的课程的同学找出，并排出；</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sid from sc where cid in (select cid 
from course where cid not in (select cid from sc where sid = '01'));
</pre><p>-- 第四步：统计剩余同学的课程数量如果和01同学的课程数量一致，则说明课程完全一致；</p><p>-- 下面是把2、3合并了之后的我的写法</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from student where sid in(
select sid from sc where cid in(
select cid from sc where sid = 01)
group by sid having count(cid) = (
select count(cid) from sc where sid = 01
))and sid != 01
</pre><p>-- 下面是我参考的原本的网上的答案</p><p><br></p><pre class="ql-syntax" spellcheck="false">SELECT * FROM student WHERE sid IN 
	(SELECT sid FROM							
-- 3.只选其中的sid（或许可以和2合并？）
		(SELECT * FROM sc AS a WHERE cid IN     
-- 2.选出所有和01号同学上过同样课的学生在sc中的信息
			(SELECT cid FROM sc WHERE sid = 01) 
-- 1.选出01号学生上过的课
		) b 
		GROUP BY sid HAVING COUNT(cid) =		
-- 5.将3得到的结果分组，若数量和4相同，则输出 
			(SELECT COUNT(cid) FROM sc c WHERE sid = 01)
-- 4.获得01号同学选课数量
	) AND sid != 01;							
-- 6.去除查询结果中为01同学本身的条目
</pre><p>-- 但是这么写还是有问题的：若总共有三门课，01同学选了2门，02同学选了3门，这种情况下，即使01和02的选课不一样，02的信息还是会出现在结果中</p><p>-- 下面的答案来自@心静思远9527，测试发现可以用</p><p><br></p><pre class="ql-syntax" spellcheck="false">SELECT Student.* FROM Student 
	WHERE sid IN 
		(SELECT sid FROM sc GROUP BY sid HAVING COUNT(sid) = 
			#下面的语句是找到'01'同学学习的课程数
			( SELECT COUNT(cid) FROM sc WHERE sid = '01')
	 	)
 	AND sid NOT IN 
 		#下面的语句是找到学过‘01’同学没学过的课程，有哪些同学。并排除他们
 		( SELECT sid FROM sc WHERE cid IN
   		#下面的语句是找到‘01’同学没学过的课程
   			( SELECT DISTINCT cid FROM sc WHERE cid NOT IN 
     			#下面的语句是找出‘01’同学学习的课程
     			( SELECT cid FROM sc WHERE sid = '01')
  			) GROUP BY sid
		) #下面的条件是排除01同学
	AND sid NOT IN ('01');
</pre><p><br></p><p>-- 10.查询没学过“张三”老师讲授的任一门课程的学生的名字</p><p>-- 用teach和course查到张三老师授的所有课，输出为结果1 - 插叙sc表中没有结果1的cid的学生sid为结果2-查询结果2的学生姓名</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname from student where sid not in (
select sid from sc left join (
select course.cid as ccid from teacher, course 
where teacher.tname = '张三' and teacher.tid = course.tid
) r on sc.cid = r.ccid where ccid is not null ); 
</pre><p>-- 上面是我的写法，先查出张三老师所带课程的cid保存为ccid，然后在把这张表left join到sc中，只输出ccid不为空的学生的sid，然后再输出sname。这种写法利用了left join后右表若不存在对应条目则为空的特性</p><p><br></p><p>-- 网上的写法1</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from student
    where student.sid not in(
        select sc.sid from sc where sc.cid in(
            select course.cid from course where course.tid in(
                select teacher.tid from teacher where tname = "张三"
            )
        )
    );
</pre><p>-- 我最开始的写法和这里的写法很像，不同的是我在查询sc表的时候就急着用not in，而这位作者留到了最外面</p><p>-- 我的做法不行的原因是，这么做相当于是在sc中一条一条的找cid不为02的结果，所以返回的是一堆选了01，03课程学生的结果。而由于每个学生每门课只能选一次，根据这个特性，只有直接用in才能返回出对的结果。</p><p>-- 网上的写法2</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from student
where student.sid not in(
    select sc.sid from sc,course,teacher 
    where
        sc.cid = course.cid
        and course.tid = teacher.tid
        and teacher.tname= "张三"
);
</pre><p>-- 网上的写法3</p><p><br></p><pre class="ql-syntax" spellcheck="false">SELECT sname FROM student 
WHERE sid NOT IN (
SELECT sid FROM sc 
LEFT JOIN course ON sc.cid=course.cid
LEFT JOIN teacher ON course.tid=teacher.tid 
WHERE tname='张三' );
</pre><p><br></p><p>-- 11. 查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.* , avgScore from student , (
select sid, avg(score) as avgScore from sc where sid in (
select sid from sc where score &lt; 60 group by sid having count(cid) &gt;= 2 
) group by sid) result where student.sid = result.sid;
</pre><p><br></p><p>-- 12.检索" 01 "课程分数小于 60，按分数降序排列的学生信息</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.* , sc.score from sc,student 
where student.sid = sc.sid and  cid = 01 and     sc.score &lt; 60 
order by sc.score desc;
</pre><p><br></p><p>-- 13.按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sc.sid,score, r.avgScore from sc,(
select sid, avg(score) as avgScore from sc group by sid) as r 
where sc.sid = r.sid  
order by r.avgScore desc;
</pre><p><br></p><p>-- 14.查询各科成绩最高分、最低分和平均分：</p><p>-- 用到条件判断 语法为 case when [condition] then [statement1] else [statement2] end</p><p>-- 显示形式：课程 ID，课程 name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率</p><p>-- 及格为&gt;=60，中等为：70-80，优良为：80-90，优秀为：&gt;=90</p><p>-- 要求输出课程号和选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列</p><p>-- 我的方法</p><p><br></p><pre class="ql-syntax" spellcheck="false">select course.cname, r.* from course, (
select cid, 
count(sid) as stu_count, max(score) as max_score, min(score) as min_score,
avg(score) as avg_score, 
(sum(case when (score &gt; 60) then 1 else 0 end)/count(score))  as P_Rate,
(sum(case when (score &gt; 70 and score &lt; 90) then 1 else 0 end)/count(score))  
as D_Rate,
(sum(case when (score &gt;= 90) then 1 else 0 end)/count(score))  as HD_Rate
from sc
group by cid 
order by stu_count desc, cid asc
) r where course.cid = r.cid
order by stu_count desc, cid asc;
</pre><p>-- 别人写的方法 基本相似，没有排序，使用了left join, 但是使用了两次group by，逻辑上不太好理解</p><p>-- GROUP BY X, Y意思是将所有具有相同X字段值和Y字段值的记录放到一个分组里。</p><p><br></p><pre class="ql-syntax" spellcheck="false">select a.cid, b.cname, max(score),min(score),round(avg(score),2),
(sum(case when (a.score &gt; 60) then 1 else 0 end)/count(a.score))  as P_Rate,
(sum(case when (a.score &gt; 70 and a.score &lt; 90) then 1 else 0 end)/count(a.score)) 
as D_Rate,
(sum(case when (a.score &gt;= 90) then 1 else 0 end)/count(a.score))  as HD_Rate
from sc a left join course b on a.cid = b.cid group by a.cid,b.cname;
</pre><p><br></p><p>-- 15.按各科成绩进行排序，并显示排名， Score 重复时保留名次空缺</p><p>-- 变量的使用参考：<a href="https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/357a02fb2d64" target="_blank">Mysql自定义变量的使用</a></p><p>-- 全网照下来唯一可以在我电脑上顺利运行的代码</p><p>-- 解析，先看最后一行</p><p>-- 为变量赋值可以使用 SET/SELECT @variable_name := value;的方法</p><p>-- 因此我们看到的最后一行的代码是 select @k:=0,@i:=0,@score:=0</p><p>-- 由于执行的时候是由内向外执行，所以这么写是OK的</p><p>-- Group By X means put all those with the same value for X in the one group.</p><p>-- Group By X, Y means put all those with the same values for both X and Y in the one group.</p><p>-- @k:= 的做法是当分数相同就并列 否则就不并列</p><p><br></p><pre class="ql-syntax" spellcheck="false">select a.sid, a.cid,
	@i:=@i+1 as r,
	@k:=(case when @score=a.score then @k else @i end) as r_no_keep,
	@score:=a.score as score
from
(select sid, cid,score from sc order by score desc)a,
(select @k=0,@i:=0,@score:=0)s;
</pre><p><br></p><p>-- 16.查询学生的总成绩，并进行排名，总分重复时保留名次空缺</p><p><br></p><pre class="ql-syntax" spellcheck="false">set @sr:=0;
select @sr:=(case when @t_s=a.t_s then @sr:=@sr else @sr:=@sr+1 end) 
as stu_rank, sid, t_s from (
select sid, sum(score) as t_s from sc group by sid order by t_s desc 
) a;
</pre><p><br></p><p>-- 17. 统计各科成绩各分数段人数：课程编号，课程名称，[100-85]，[85-70]，[70-60]，[60-0] 及所占百分比</p><p>-- 我自己的写法，把比率的计算放到最后， 过于复杂,主要是任何计算结果为0的时候mysql都会自动显示为null，处理这一步的case when写了不少</p><p><br></p><pre class="ql-syntax" spellcheck="false">select course.cid,course.cname,
 case when hd.rt/t.rt is not null then hd.rt/t.rt else 0 end  as hdrt,
 case when d.rt/t.rt is not null then   d.rt/t.rt else 0 end  as drt ,
 case when  p.rt/t.rt is not null then   p.rt/t.rt else 0 end as prt,
 case when f.rt/t.rt is not null then f.rt/t.rt else 0 end as frt
 from course left join   
 (select cid, count(*) as rt from sc where (score &lt;= 100 &amp;&amp; score &gt; 85) 
group by cid) as hd on hd.cid = course.cid 
left join (select cid, ( case when count(*) is not  null 
then count(*) else 0 end) as rt from sc where (score &lt;= 85 &amp;&amp; score &gt; 70) 
group by cid) as d on d.cid = course.cid 
left join (select cid, ( case when count(*) is not  null 
then count(*) else 0 end) as rt from sc where (score &lt;= 70 &amp;&amp; score &gt; 60) 
group by cid) as p on p.cid = course.cid 
left join (select cid, ( case when count(*) is not  null 
then count(*) else 0 end) as rt from sc where (score &lt;= 60 &amp;&amp; score &gt; 0) 
group by cid) as f on f.cid = course.cid 
left join (select cid, ( case when count(*) is not  null 
then count(*) else 0 end) as rt from sc  group by cid) as t 
on t.cid = course.cid order by course.cid ; 
</pre><p>-- 网上答案的核心思想：用sum先算出来比率再一个一个join</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid,SUM(case when score &gt;85 and score &lt;=100 
then 1 else 0 end) as `85-100`,
ROUND(100*(SUM(case when score &gt;85 and score &lt;=100 
then 1 else 0 end)/count(*)),2) as 百分比
from sc GROUP BY cid;
</pre><p>-- 也是一个一个left join 最后join course 表然后select 一下就可以了</p><p>-- sum (case when ... then 1 else 0 end) 也是一个很不错的写法</p><p><br></p><pre class="ql-syntax" spellcheck="false">select course.cid, course.cname, a.`per` as `85-100`, 
b.`per` as `85-70`, c.`per` as `70-60`, d.`per` as `60-0`
from course 
left join (select cid, sum(case when score &gt; 85 and score &lt;= 100 
then 1 else 0 end) as `num`,
round(100*sum(case when score &gt; 85 and score &lt;= 100 
then 1 else 0 end)/count(*),2) as `per`
from sc group by cid) as a on a.cid = course.cid
left join (select cid, sum(case when score &gt; 70 and score &lt;= 85 
then 1 else 0 end) as `num`,
round(100*sum(case when score &gt; 70 and score &lt;= 85 
then 1 else 0 end)/count(*),2) as `per`
from sc group by cid) as b on b.cid = course.cid
left join (select cid, sum(case when score &gt; 60 and score &lt;= 70 
then 1 else 0 end) as `num`,
round(100*sum(case when score &gt; 60 and score &lt;= 70 
then 1 else 0 end)/count(*),2) as `per`
from sc group by cid) as c on c.cid = course.cid
left join (select cid, sum(case when score &gt; 0 and score &lt;= 60 
then 1 else 0 end) as `num`,
round(100*sum(case when score &gt; 0 and score &lt;= 60 
then 1 else 0 end)/count(*),2) as `per`
from sc group by cid) as d on d.cid = course.cid
order by course.cid;
</pre><p><br></p><p>-- 18.查询各科成绩前三名的记录</p><p>-- 知识点: search self! #important</p><p>-- 这种方法太难想了我选择放弃, 感觉比第九题都要难</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from sc where (
select count(*) from sc as a 
where sc.cid = a.cid and sc.score&lt;a.score
)&lt;3 order by cid asc, sc.score desc;
</pre><p>-- method 2 相对好理解的一种方法</p><p>-- 1.选出b表比a表成绩大的所有组</p><p>-- 2.选出比当前id成绩大的 小于三个的</p><p><br></p><pre class="ql-syntax" spellcheck="false">select a.sid,a.cid,a.score from sc a 
left join sc b on a.cid = b.cid and a.score&lt;b.score
group by a.sid,a.cid,a.score HAVING COUNT(b.sid)&lt;3
ORDER BY a.cid,a.score DESC
</pre><p><br></p><p>-- 19.查询每门课程被选修的学生数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid, count(sid) from sc group by cid;
</pre><p><br></p><p><br></p><p>-- 20.查询出只选修两门课程的学生学号和姓名</p><p><br></p><pre class="ql-syntax" spellcheck="false">select r.sid, student.sname from (
select sid from sc  group by sid having count(cid) = 2) r, student
where student.sid = r.sid; 
</pre><p><br></p><p>-- 21. 查询男生、女生人数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select ssex, count(ssex) from student group by ssex;
</pre><p><br></p><p><br></p><p>-- 22. 查询名字中含有 风 字的学生信息</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from student where sname like '%风%';
</pre><p><br></p><p><br></p><p>-- 23. 查询同名同姓学生名单，并统计人数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select *  from student s1 inner join student s2 
on s1.sname = s2.sname and s1.sid != s2.sid;
-- method 2:
select sname,count(sname) as sameName 
from student group by sname having sameName &gt; 1;
</pre><p><br></p><p>-- 24. 查询1990年出生的学生名单</p><p><br></p><pre class="ql-syntax" spellcheck="false">select * from student where date_format(sage,'%Y') = '1990';
select sname from student where year(sage) like '1990%';
</pre><p><br></p><p>-- 25. 查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid, avg(score) as avgScore from sc 
group by cid order by avgScore desc, cid asc ; 
</pre><p><br></p><p>-- 26.查询平均成绩大于等于 85 的所有学生的学号、姓名和平均成绩</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.sname, r.* from student inner join (
select sid, avg(score) from sc group by sid having avg(score) &gt; 85 ) r 
on student.sid = r.sid;
</pre><p><br></p><p>-- 27. 查询课程名称为「数学」，且分数低于 60 的学生姓名和分数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.sname, r.score from student, (
select sc.sid, sc.cid, sc.score , course.cname from sc, course 
where sc.cid = course.cid and sc.score &lt; 60 and course.cname = '数学'
) r where student.sid = r.sid;
</pre><p><br></p><p>-- 28. 查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.*, sc.* from student left join sc on student.sid = sc.sid;
select sname, sc.cid, sc.score from sc inner join student as s on sc.sid = s.sid;
</pre><p><br></p><p>-- 29. 查询任何一门课程成绩在 70 分以上的姓名、课程名称和分数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select r.sname, c.cname, r.score from course c,(
select s.sname as sname , cid, score  from sc 
left join student s on s.sid = sc.sid where score &gt; 70
) r where c.cid = r.cid;
</pre><p><br></p><p>-- 30. 查询不及格的课程</p><p><br></p><pre class="ql-syntax" spellcheck="false">select c.cname, r.sn from course c ,( 
select cid, count(sid) as sn from sc where score &lt; 60 group by cid) r
where c.cid = r.cid
</pre><p><br></p><p>-- 31. 查询课程编号为 01 且课程成绩在 80 分以上的学生的学号和姓名</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sc.sid, student.sname  from sc, student  
where sc.sid = student.sid and  cid = '01' and score &gt;= 80;
</pre><p><br></p><p>-- 32. 求每门课程的学生人数</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid, count(sid) from sc group by cid;
</pre><p><br></p><p><br></p><p>-- 33. 成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sc.cid, sc.sid, sc.score from sc where cid = (
select course.cid from teacher, course where 
teacher.tid = course.tid and tname = '张三') order by sc.score desc limit 1;
</pre><p><br></p><p>-- 34.成绩有重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其&gt;成绩(也就是要显示所有最高分学生的信息)</p><p>-- 在做之前先update</p><p><br></p><pre class="ql-syntax" spellcheck="false">update sc set score = 90 where sid = "07" and cid = "02";
select student.*, r.score from student, (
 select sc.sid, sc.score as score  from sc where score = (
    select max(score) from sc where cid = '02')) r 
where student.sid = r.sid
</pre><p>-- 做完之后恢复数据</p><p><br></p><pre class="ql-syntax" spellcheck="false">update sc set score = 89 where sid = "07" and cid = "02";
</pre><p><br></p><p><br></p><p>-- 35.查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩</p><p>-- 只要从第一张表中获取distinct就可以了</p><p><br></p><pre class="ql-syntax" spellcheck="false">select distinct  a.* from sc a 
inner join sc b on a.score = b.score and a.cid != b.cid;
</pre><p><br></p><p>-- 36. 和18题一样 只是2个人变成了3个人</p><p>-- 依然不会 网上的答案:</p><p><br></p><pre class="ql-syntax" spellcheck="false">SELECT * FROM  sc WHERE  (SELECT COUNT(*)  FROM  sc AS a 
WHERE sc.cid = a.cid AND sc.score &lt; a.score) &lt; 2 
ORDER BY cid ASC,  sc.score DESC ;
</pre><p><br></p><p>--或者下面的写法, 唯一的区别就是count(*)变成了count(1)</p><p><br></p><pre class="ql-syntax" spellcheck="false">select a.sid,a.cid,a.score from sc a
where (select COUNT(1) from sc b where b.cid=a.cid 
and b.score&gt;=a.score)&lt;=2 ORDER BY a.cid;
</pre><p><br></p><p>-- 37. 统计每门课程的学生选修人数（超过 5 人的课程才统计）</p><p><br></p><pre class="ql-syntax" spellcheck="false">select cid, count(sid) from sc group by cid having count(sid) &gt;= 5;
</pre><p><br></p><p><br></p><p>-- 38. 检索至少选修两门课程的学生学号</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sid, count(cid) from sc group by sid having count(cid) &gt;= 2;
</pre><p><br></p><p><br></p><p>-- 39.查询选修了全部课程的学生信息</p><p><br></p><pre class="ql-syntax" spellcheck="false">select student.* from student inner join (
select sid from sc group by sid having count(cid) = ( 
select count(*) from course)) r on student.sid = r.sid;
</pre><p>-- 40.查询各学生的年龄，只按年份来算</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname, timestampdiff(year,sage,now()) as sage from student;
select sname, year(now()) - year(sage) as sage from student;
</pre><p>-- 41. 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname,
case when (
date_format(now(), '%m-%d') &lt; date_format(Sage, '%m-%d'))
then year(now()) - year(sage) + 1
else year(now()) - year(sage) end as age
from student;
</pre><p>-- 42. 查询本周过生日的学生</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname from student where week(Sage) = week(now());
</pre><p><br></p><p>-- 43. 查询下周过生日的学生</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname from student where week(Sage) = week(now()) + 1;
select * from student where WEEK(DATE_FORMAT(NOW(),'%Y%m%d'))+1 =WEEK(sage);
</pre><p>-- 44. 查询本月过生日的学生</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname from student where month(Sage) = month(now());
select * from student where MONTH(DATE_FORMAT(NOW(),'%Y%m%d')) =MONTH(sage);
</pre><p><br></p><p>-- 45. 查询下月过生日的学生</p><p><br></p><pre class="ql-syntax" spellcheck="false">select sname from student where month(Sage) = month(now()) + 1;
</pre><p><br></p><div id="paginator"></div></div><div id="post-footer"></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a><a onclick="BgmControl()"><svg id="bgm-control" viewBox="0 0 30 34" fill="currentColor" style="width: 24px; transition: transform .3s;margin-top: 4px"><path d="M25.998 23.422V11.29h3.999v12.132h-3.999zM19.497 6.234h4.001v22.243h-4.001V6.234zM12.998.867h4v32.978h-4V.867zm-6.5 5.367h4.001v22.243H6.498V6.234zm-6.5 5.056h4v12.132h-4V11.29z"></path></svg><audio id="bgm" src="/audio/bgm.mp3" crossorigin="anonymous"> </audio></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo" style="margin:0;border-radius:0;"></a><h1 id="Dr"><a href="/">Mornikar</a></h1><div id="description"><p>It is time to get up and make efforts</p></div></div><div id="aside-block"></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr><wbr><nobr> Build Time<script>const buildTime = new Date("2025-09-12T11:13:32.007Z");
document.write(' ' + buildTime.toLocaleString());</script></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>